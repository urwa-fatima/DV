<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Line chart for Asian Countries</title>
    <link rel="icon" type="image/png" sizes="64x64" href="../images/favicon3.ico">

    <!-- Font Awesome icons (free version)-->
    <script src="https://use.fontawesome.com/releases/v6.1.0/js/all.js" crossorigin="anonymous"></script>
    <!-- Google fonts-->
    <link href="https://fonts.googleapis.com/css?family=Catamaran:100,200,300,400,500,600,700,800,900"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Lato:100,100i,300,300i,400,400i,700,700i,900,900i"
        rel="stylesheet" />
    <!-- Core theme CSS (includes Bootstrap)-->
    <link href="../css/styles.css" rel="stylesheet" />
    <link href="../css/style-custom.css" rel="stylesheet" />

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <!-- d3 library -->
    <script src="https://d3js.org/d3.v6.js"></script>
    <style>
        /* AXES */
        /* ticks */
        .axis line {
            stroke: #706f6f;
            stroke-width: 0.5;
            shape-rendering: crispEdges;
        }

        /* axis contour */
        .axis path {
            stroke: #706f6f;
            stroke-width: 0.7;
            shape-rendering: crispEdges;
        }

        /* axis text */
        .axis text {
            fill: #2b2929;
            font-family: Georgia;
            font-size: 120%;
        }

        /* LINE CHART */
        path.line-0 {
            fill: none;
            stroke: #ed3700;
        }

        path.line-1 {
            fill: none;
            stroke: #2b2929;
            stroke-dasharray: 2;
        }

        path.line-2 {
            fill: none;
            stroke: #9c9c9c;
            stroke-dasharray: 6;
        }

        .serie_label {
            fill: #2b2929;
            font-family: Georgia;
            font-size: 80%;
        }
    </style>
</head>

<body class="d-flex flex-column min-vh-100">

    <!-- <div class="mb-auto" id="top-header"></div>
    <div class="container px-5">
        <div class="row gx-5 align-items-center">
            <div class="col-lg-6 order-lg-2">
                <div id="tooltip" class="hidden">
                    <p><strong>Description</strong></p>
                    <p><span id="value">description</span></p>
                </div>
                 <div id="line-chart-1" class="p-5"></div>
                <div id="container" class="svg-container"></div>
            </div>
            <div class="col-lg-6 order-lg-1">
                <div class="p-5">
                    <h2 class="display-4">We salute you!</h2>
                    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Quod aliquid, mollitia odio veniam
                        sit iste esse assumenda amet aperiam exercitationem, ea animi blanditiis recusandae! Ratione
                        voluptatum molestiae adipisci, beatae obcaecati.</p>
                </div>
            </div>
        </div> 
    </div>-->

    <!-- Header -->

    <div class="mb-5" id="top-header"></div>

    <!-- heading and svg -->
    <div class="container px-5 py-5">
        <div class="row gx-5 align-items-center">
            <div class="col">
                <h2 class="display-4">We salute you!</h2>
                <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Quod aliquid, mollitia odio veniam
                    sit iste esse assumenda amet aperiam exercitationem, ea animi blanditiis recusandae! Ratione
                    voluptatum molestiae adipisci, beatae obcaecati.</p>
            </div>
        </div>
        <div class="row gx-5 align-items-center">
            <div id="container" class="svg-container"></div>
        </div>

    </div>

    <div class="mt-auto" id="down-footer"></div>
    <script src="../js/scripts.js"></script>
    <script src="../js/line-chart.js"></script>
    <script>
        const width = 960;
        const height = 500;
        const margin = 5;
        const padding = 5;
        const adj = 30;

        // we are appending SVG first
        const svg = d3.select("div#container").append("svg")
            .attr("preserveAspectRatio", "xMinYMin meet")
            .attr("viewBox", "-"
                + adj + " -"
                + adj + " "
                + (width + adj * 3) + " "
                + (height + adj * 3))
            .style("padding", padding)
            .style("margin", margin)
            .classed("svg-content", true);

        //-----------------------------DATA-----------------------------//
        const timeConv = d3.timeParse("%d-%b-%Y");
        const dataset = d3.csv("data.csv");
        dataset.then(function (data) {
            var slices = data.columns.slice(1).map(function (id) {
                return {
                    id: id,
                    values: data.map(function (d) {
                        return {
                            date: timeConv(d.date),
                            measurement: +d[id]
                        };
                    })
                };
            });

            console.log("Column headers", data.columns);
            console.log("Column headers without date", data.columns.slice(1));
            // returns the sliced dataset
            console.log("Slices", slices);
            // returns the first slice
            console.log("First slice", slices[0]);
            // returns the array in the first slice
            console.log("A array", slices[0].values);
            // returns the date of the first row in the first slice
            console.log("Date element", slices[0].values[0].date);
            // returns the array's length
            console.log("Array length", (slices[0].values).length);
            //----------------------------SCALES----------------------------//
            const xScale = d3.scaleTime().range([0, width]);
            const yScale = d3.scaleLinear().rangeRound([height, 0]);

            xScale.domain(d3.extent(data, function (d) {
                return timeConv(d.date)
            }));

            yScale.domain([(0), d3.max(slices, function (c) {
                return d3.max(c.values, function (d) {
                    return d.measurement + 4;
                });
            })
            ]);

            //-----------------------------AXES-----------------------------//
            const yaxis = d3.axisLeft()
                .ticks((slices[0].values).length)
                .scale(yScale);

            const xaxis = d3.axisBottom()
                .ticks(d3.timeDay.every(1))
                .tickFormat(d3.timeFormat('%b %d'))
                .scale(xScale);

            //----------------------------LINES-----------------------------//
            const line = d3.line()
                .x(function (d) { return xScale(d.date); })
                .y(function (d) { return yScale(d.measurement); });

            let id = 0;
            const ids = function () {
                return "line-" + id++;
            }

            //---------------------------TOOLTIP----------------------------//


            //-------------------------2. DRAWING---------------------------//
            //-----------------------------AXES-----------------------------//
            svg.append("g")
                .attr("class", "axis")
                .attr("transform", "translate(0," + height + ")")
                .call(xaxis);

            svg.append("g")
                .attr("class", "axis")
                .call(yaxis)
                .append("text")
                .attr("transform", "rotate(-90)")
                .attr("dy", ".75em")
                .attr("y", 6)
                .style("text-anchor", "end")
                .text("Frequency");

            //----------------------------LINES-----------------------------//
            const lines = svg.selectAll("lines")
                .data(slices)
                .enter()
                .append("g");

            lines.append("path")
                .attr("class", ids)
                .attr("d", function (d) { return line(d.values); });

            lines.append("text")
                .attr("class", "serie_label")
                .datum(function (d) {
                    return {
                        id: d.id,
                        value: d.values[d.values.length - 1]
                    };
                })
                .attr("transform", function (d) {
                    return "translate(" + (xScale(d.value.date) + 10)
                        + "," + (yScale(d.value.measurement) + 5) + ")";
                })
                .attr("x", 5)
                .text(function (d) { return ("Serie ") + d.id; });

            //---------------------------POINTS-----------------------------// 

            //---------------------------EVENTS-----------------------------// 

        });


    </script>

</body>

</html>